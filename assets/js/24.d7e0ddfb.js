(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{594:function(e,r,t){"use strict";t.r(r);var a=t(55),n=Object(a.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"dockerにnginxとrailsとvueの環境を作る"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerにnginxとrailsとvueの環境を作る"}},[e._v("#")]),e._v(" DockerにnginxとRailsとVueの環境を作る")]),e._v(" "),t("p",[e._v("カレンダーに穴が空いていたので穴埋めに推参しました。飛び込み参加&拙い記事になりますがご容赦くださいませ。")]),e._v(" "),t("h2",{attrs:{id:"想定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#想定"}},[e._v("#")]),e._v(" 想定")]),e._v(" "),t("p",[e._v("最近、XDが便利すぎてjQueryでフロント動かすのがしんどくなってきたので、Vue導入するために勉強をはじめました。"),t("br"),e._v("\n昨今のjavascriptはjavascriptのくせに（※認識が古い）パッケージ管理とかが必要なくらいファイルが増えて面倒なのでDockerで動かすことにしました。昔はtableチカチカさせるだけみたいな使えない子だったのにな君。")]),e._v(" "),t("p",[t("img",{attrs:{src:"/blog/assets/img/a4b60c6b-b624-dbf5-ea03-c3dff924e420.png",alt:"図"}})]),e._v(" "),t("p",[t("del",[e._v("この図必要か？")])]),e._v(" "),t("p",[e._v("RailsでAPIを作り、Vueでそれを参照する想定です。"),t("br"),e._v("\nRailsなら弊社のエンジニアはだいたい書けるし、デザイナーさんもpug書けるしsass書けるし、結構楽に導入できるんと違う？という"),t("del",[e._v("甘い")]),e._v("見積もりによりこの構成にしました。")]),e._v(" "),t("h2",{attrs:{id:"ファイル構成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ファイル構成"}},[e._v("#")]),e._v(" ファイル構成")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("/project\n  .docker-compose\n  server\n    Dockerfile\n    Gemfile\n    Gemfile.lock\n    Rakefile\n    app ほか\n  client\n    Dockerfile\n  data\n    www\n")])])]),t("p",[t("code",[e._v("/project/data/www")]),e._v("の下にVueのファイルが入ります。Railsのポートを3000番に、Vueを80番に繋ぐ。")]),e._v(" "),t("p",[e._v("この間は地味な作業なので割愛します。APIとVueコンポーネントをしこしこ書いていきます。"),t("br"),e._v("\n作業中のやらかし: "),t("a",{attrs:{href:"https://teratail.com/questions/227363",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker上のVueからDocker上のswaggerAPIを叩きたい - teratail"),t("OutboundLink")],1),t("br"),e._v("\nCORSでもない？404ってなんで？！ブラウザでは開けるのに？！となってteratailに行きましたが、ソースにpostって書いてあっただけでした。getに書き直したら普通にCORSが出た。恥ずか死")]),e._v(" "),t("h2",{attrs:{id:"cors発生"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cors発生"}},[e._v("#")]),e._v(" CORS発生")]),e._v(" "),t("p",[e._v("そりゃそうだ。ポート違うもの。"),t("br"),e._v("\nこれを回避しようと調査していると、どうやらnginxを入れてプロキシサーバにしてやるといいらしい。")]),e._v(" "),t("p",[t("strong",[e._v("docker-compose.yml")])]),e._v(" "),t("div",{staticClass:"language-yaml:docker-compose.yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  nginx:\n    build: ./nginx\n    ports:\n      - '9000:9000'\n    volumes:\n      - ./nginx/server.conf:/etc/nginx/nginx.conf\n    links:\n      - server\n      - client\n")])])]),t("div",{staticClass:"language-nginx.conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('  server {\n    listen 9000;\n    server_name localhost;\n    location / {\n        proxy_pass  http://server:3000;\n        proxy_set_header Host localhost;\n        add_header Access-Control-Allow-Origin http://localhost;\n        add_header Access-Control-Allow-Methods "POST, GET, PUT, PATCH, DELETE, OPTIONS";\n        add_header Access-Control-Allow-Headers "Origin, Authorization, Accept";\n        add_header Access-Control-Allow-Credentials true;\n    }\n  }\n')])])]),t("p",[e._v("ということで、VueでRailsのAPIからデータを取得して画面表示ができました！"),t("del",[e._v("やったねたえちゃん！")])]),e._v(" "),t("p",[e._v("この後、CSRFで血の泡を吹くのはまた別のお話……（※未解決）"),t("br"),e._v("\n兎にも角にもセキュリティはクリアしないと業務に導入できないので今後も頑張ります。接続先IPが固定になればそれでいいような気もしているのですが……インフラ知識は（も）無い……")]),e._v(" "),t("p",[e._v("Q.VueCLIを選んだのが悪いのでは？"),t("br"),e._v("\nA.erb嫌いだからjQueryついでに爆殺したかったんだよ……")]),e._v(" "),t("h2",{attrs:{id:"作業中お世話になりました"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作業中お世話になりました"}},[e._v("#")]),e._v(" 作業中お世話になりました")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://qiita.com/akashixi/items/2ebe9404c64a8854b4e5",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-composeを使ってnginx上でVueアプリケーションを動かす"),t("OutboundLink")],1),t("br"),e._v(" "),t("a",{attrs:{href:"https://qiita.com/tubutubu_mustard/items/ed8c047540015e2d07fc",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-composeを使ってVue.jsのプロジェクトを作成して、Dockerで動かしてみた"),t("OutboundLink")],1),t("br"),e._v(" "),t("a",{attrs:{href:"https://qiita.com/bo-san/items/85d734fd07ca3703b16b",target:"_blank",rel:"noopener noreferrer"}},[e._v("vue.jsでウィンドウ読み込み時に関数実行したいときの書き方"),t("OutboundLink")],1),t("br"),e._v(" "),t("a",{attrs:{href:"https://qiita.com/74th/items/3545366f5f66eb70ff85",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker上のnginxから、別のコンテナのwebへリバースプロキシさせる"),t("OutboundLink")],1),t("br"),e._v(" "),t("a",{attrs:{href:"https://qiita.com/schwarz471/items/9b44adfbec006eab60b0",target:"_blank",rel:"noopener noreferrer"}},[e._v("Nginxによるリバースプロキシの設定方法"),t("OutboundLink")],1)])])}),[],!1,null,null,null);r.default=n.exports}}]);