(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{610:function(t,s,a){"use strict";a.r(s);var n=a(55),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"【rails】今年学んだことの棚卸し"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【rails】今年学んだことの棚卸し"}},[t._v("#")]),t._v(" 【Rails】今年学んだことの棚卸し")]),t._v(" "),a("p",[t._v("今年はRailsをたくさん書いた年だったのでRailsについて書き留めておきます。")]),t._v(" "),a("h2",{attrs:{id:"モデルリレーションにエイリアスを付けたい"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#モデルリレーションにエイリアスを付けたい"}},[t._v("#")]),t._v(" モデルリレーションにエイリアスを付けたい")]),t._v(" "),a("p",[t._v("UserテーブルはUserテーブルである場合が多い。システムから見てユーザはユーザだからです。ですが、システム内においてユーザはユーザではなく、出品者であり、購入者であり、主催者であり、投稿者であり、フォロワーでありフォロイーです。これを")]),t._v(" "),a("p",[a("strong",[t._v("contest.rb")])]),t._v(" "),a("div",{staticClass:"language-rb:contest.rb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('class Contest < ApplicationRecord\n  belongs_to :organizer, class_name: "User"\nend\n')])])]),a("p",[t._v("こうする。")]),t._v(" "),a("p",[a("strong",[t._v("article.rb")])]),t._v(" "),a("div",{staticClass:"language-rb:article.rb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('class Article < ApplicationRecord\n  belongs_to :author, class_name: "User"\nend\n')])])]),a("p",[t._v("こうする。")]),t._v(" "),a("p",[t._v("するとコントローラ側からは")]),t._v(" "),a("div",{staticClass:"language-rb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-rb"}},[a("code",[t._v("contest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("organizer "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#←ユーザ")]),t._v("\narticle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("author "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#←ユーザ")]),t._v("\n")])])]),a("p",[t._v("こうアクセスできる！マーベラス！"),a("br"),t._v("\nDDDには向かないと言われるRails(要出典)ですが、まあ概念を少し近づけることはできるのかなと。"),a("code",[t._v("article.user")]),t._v("よりは"),a("code",[t._v("article.author")]),t._v("の方が多少はドメインモデル的かなと。DDDあんま理解してませんけど。何にせよロールは明確な方がよい。")]),t._v(" "),a("p",[t._v("もちろんDB側も"),a("code",[t._v("organizer_id")]),t._v("とか"),a("code",[t._v("author_id")]),t._v("とかになるので設計者がここ押さえてないと使えませんけどね。リーダブルなコードはリーダブルな設計から生まれてくるものです。コード書けない人間を設計者にするのはやめてほしい。今年は「設計者が多対多リレーションを知らない」という局面に当たりました。転職を検討しています。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/tkawa/items/dc3e313021f32fd91ca6",target:"_blank",rel:"noopener noreferrer"}},[t._v("交差テーブルには関連の意味を表す名前をつけよう - Qiita"),a("OutboundLink")],1),t._v("のコメントで言及した通り、テーブルそれ自体の命名に役割が含まれているなら上記は不要です。")]),t._v(" "),a("h2",{attrs:{id:"同じテーブルを別条件で接続する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同じテーブルを別条件で接続する"}},[t._v("#")]),t._v(" 同じテーブルを別条件で接続する")]),t._v(" "),a("p",[t._v("こうすると")]),t._v(" "),a("p",[a("strong",[t._v("article.rb")])]),t._v(" "),a("div",{staticClass:"language-rb:article.rb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('class Article < ApplicationRecord\n  has_one :main_image, -> { where main_image: true }, class_name: "Image"\n  accepts_nested_attributes_for :main_image\n  has_many :sub_images, -> { where main_image: false }, class_name: "Image"\n  accepts_nested_attributes_for :sub_images\nend\n')])])]),a("p",[a("strong",[t._v("_form.erb")])]),t._v(" "),a("div",{staticClass:"language-html:_form.erb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('  <div class="field">\n    <span>メインイメージ（サムネイル用）</span><br />\n    <%= form.fields_for :main_image do |image| %>\n      <label class="file-label">\n        <i class="fas fa-camera"></i>\n        <%= image.file_field :path, required: true, accept: \'image/png,image/gif,image/jpeg\' %>\n      </label>\n    <% end %>\n  </div>\n  <div class="field">\n    <label>サブイメージ（3枚まで指定できます）</label><br />\n    <%= form.fields_for :sub_images do |image| %>\n      <label class="file-label">\n        <i class="fas fa-camera"></i>\n        <%= image.file_field :path, accept: \'image/png,image/gif,image/jpeg\' %>\n      </label>\n    <% end %>\n  </div>\n')])])]),a("p",[t._v("こう書ける！！！"),a("br"),t._v("\nこのwhereのところ、"),a("code",[t._v("arel_table")]),t._v("とかも動いたので")]),t._v(" "),a("p",[a("strong",[t._v("blog.rb")])]),t._v(" "),a("div",{staticClass:"language-rb:blog.rb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('class Blog < ApplicationRecord\n  # 予約投稿の一覧\n  has_many :received_articles, -> { where Article.arel_table[:publish_date].gt(Time.zone.now) }, class_name: "Article"\nend\n')])])]),a("p",[t._v("こういうことができます。"),a("br"),t._v("\nシステム上一件しか登録できない（登録時バリデーションで弾く）けど裏では複数件持ってて管理側では複数件表示したいみたいなややこしい設計が存在しても、上記使えば"),a("code",[t._v("has_one :active")]),t._v("とかできるので私の嫌いな"),a("code",[t._v("where({status: :active}).first")]),t._v("を書かずに済みます。イェーイ。")]),t._v(" "),a("h3",{attrs:{id:"scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scope"}},[t._v("#")]),t._v(" scope")]),t._v(" "),a("div",{staticClass:"language-rb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-rb"}},[a("code",[t._v("  scope "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":top_10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'novels.id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("order"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Arel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'COUNT(craps.id) + COUNT(reviews.rate) * 10'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("limit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("引数渡すならこう")]),t._v(" "),a("div",{staticClass:"language-rb extra-class"},[a("pre",{pre:!0,attrs:{class:"language-rb"}},[a("code",[t._v("  scope "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":top_n")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'novels.id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("order"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Arel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'COUNT(craps.id) + COUNT(reviews.rate) * 10'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("limit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 呼び出し")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Novel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("includes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left_joins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":chapters")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":craps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":reviews")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top_n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"n-1問題"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#n-1問題"}},[t._v("#")]),t._v(" N+1問題")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://qiita.com/massaaaaan/items/4eb770f20e636f7a1361",target:"_blank",rel:"noopener noreferrer"}},[t._v("【Ruby on Rails】N+1問題ってなんだ？"),a("OutboundLink")],1),a("br"),t._v(" "),a("a",{attrs:{href:"https://qiita.com/k0kubun/items/80c5a5494f53bb88dc58",target:"_blank",rel:"noopener noreferrer"}},[t._v("ActiveRecordのjoinsとpreloadとincludesとeager_loadの違い"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("N+1に対処しつつjoinしたテーブルのカラムで並べ替えたいとかいうときはどうすればいいんだ？　でしばらくハマったものの、なんのことはない、joinとeager_loadは両立できる")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Novel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("includes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left_joins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("chapters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":craps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":reviews")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top_10\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" NAMES utf8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  @"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@SESSION.sql_mode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CONCAT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONCAT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@sql_mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("',STRICT_ALL_TABLES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("',NO_AUTO_VALUE_ON_ZERO'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  @"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@SESSION.sql_auto_is_null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@SESSION.wait_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2147483")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OUTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("chapters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("chapters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("novel_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OUTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("craps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("craps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("chapter_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("chapters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OUTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("reviews"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("reviews"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("novel_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("COUNT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("craps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("COUNT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reviews"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LIMIT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tags_novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tags_novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tags_novels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("novel_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"n-1問題が置きていないかを監視するgem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#n-1問題が置きていないかを監視するgem"}},[t._v("#")]),t._v(" N+1問題が置きていないかを監視するgem")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/flyerhzm/bullet",target:"_blank",rel:"noopener noreferrer"}},[t._v("bullet"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("code",[t._v("config/development.rb")]),t._v(" の "),a("code",[t._v("Rails.application.configure")]),t._v(" 内に以下を追記")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("  config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("after_initialize "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Bullet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enable "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Bulletプラグインを有効")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Bullet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alert "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JavaScriptでの通知")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Bullet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bullet_logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# log/bullet.logへの出力")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Bullet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ブラウザのコンソールログに記録")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Bullet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rails_logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Railsログに出力")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),a("p",[t._v("alertはわかりやすくていいけどちょっと鬱陶しいかもしれない。Railsログとコンソールログに出てれば十分な気がする。")]),t._v(" "),a("h2",{attrs:{id:"ほか"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ほか"}},[t._v("#")]),t._v(" ほか")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("3.months")]),t._v(" あたりの記法に「"),a("strong",[t._v("正気か？")]),t._v("」という感想しかわかない")]),t._v(" "),a("li",[t._v("全体的に検索性が悪い。他言語から入った人間が「Railsではどう書くんだ？」と検索して正解にたどり着くのがあまりにも難しい\n"),a("ul",[a("li",[t._v("%記法とか")]),t._v(" "),a("li",[t._v("|=とか")]),t._v(" "),a("li",[t._v("&.とか")])])]),t._v(" "),a("li",[a("code",[t._v("defined?")]),t._v(" がnilを返すのはどういう了見なんですかね……？")])])])}),[],!1,null,null,null);s.default=e.exports}}]);