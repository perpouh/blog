(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{625:function(t,s,n){"use strict";n.r(s);var a=n(55),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"vscodeの拡張機能を作った"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vscodeの拡張機能を作った"}},[t._v("#")]),t._v(" VSCodeの拡張機能を作った")]),t._v(" "),n("p",[t._v("TypeScript初挑戦。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://kakuyomu.jp",target:"_blank",rel:"noopener noreferrer"}},[t._v("カクヨム"),n("OutboundLink")],1),t._v("という小説投稿サイトがある。"),n("br"),t._v("\nここでは"),n("a",{attrs:{href:"https://kakuyomu.jp/help/entry/notation",target:"_blank",rel:"noopener noreferrer"}},[t._v("カクヨム記法"),n("OutboundLink")],1),t._v("というものを用いて、ルビや傍点を処理できる。"),n("br"),t._v("\nしかしながら当方にはWeb上で文章の塊を書く趣味はない。文章は必ずローカルで書き、コピーし、Webフォームにペーストして投稿する。さもなくば消える。インターネットに対する信用度が00年代初頭からあまり上がっていないのだと思う。"),n("br"),t._v("\n加えて、このカクヨムのプレビューが割と見づらい。毎度タブを移動する動きになるため、上から下に毎度スクロールしなくてはならない。だるい。めんどくさい。VSCodeでリアルタイムプレビューしたい。")]),t._v(" "),n("p",[t._v("益体のない文章を十数万字も書きながらそのちょっとのスクロールを面倒に感じるあたり、そしてそこからよしプログラム書こうとなるあたりがエンジニアなのだと思う。我ながらどう考えても手間暇の価値基準が狂っている。")]),t._v(" "),n("p",[t._v("まあでもルビくらいはなんてことない。String.prototype.replaceすればいいだけなので。")]),t._v(" "),n("p",[t._v("リポジトリはこちら\n"),n("link-card",{attrs:{url:"https://github.com/perpouh/kkympreviewer",siteName:"github.com",thumbnail:"https://avatars0.githubusercontent.com/u/8610298?s=400&v=4",title:"perpouh/kkympreviewer",description:"カクヨム記法プレビューワ(VSCode拡張)"}})],1),t._v(" "),n("p",[t._v("まず公式サイトを参考に、プロジェクトの雛形を作ります。"),n("br"),t._v(" "),n("a",{attrs:{href:"https://code.visualstudio.com/api/get-started/your-first-extension",target:"_blank",rel:"noopener noreferrer"}},[t._v("Your First Extension - Visual Studio Code"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g yo generator-code\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("yo code\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ? What type of extension do you want to create? New Extension (TypeScript)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ? What's the name of your extension? HelloWorld")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Press <Enter> to choose default for all options below ###")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ? What's the identifier of your extension? helloworld")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ? What's the description of your extension? LEAVE BLANK")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ? Initialize a git repository? Yes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ? Which package manager to use? npm")]),t._v("\n")])])]),n("p",[t._v("F5を押してデバッグモードを開き、コマンドパレットからハローワールドを実行。動かない。"),n("br"),t._v("\n詰むの早いな？　と思いながら"),n("code",[t._v("npm install")]),t._v("したりVSCodeのアップグレードしたりしたら動きました。あとは愛用している拡張のひとつである"),n("a",{attrs:{href:"https://github.com/yzhang-gh/vscode-markdown",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode-markdown"),n("OutboundLink")],1),t._v("のソースを参考にもりもり書きます。")]),t._v(" "),n("h2",{attrs:{id:"変換した文章をどこに表示するか？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#変換した文章をどこに表示するか？"}},[t._v("#")]),t._v(" 変換した文章をどこに表示するか？")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/yzhang-gh/vscode-markdown",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode-markdown"),n("OutboundLink")],1),t._v("のコードを読んだ結果、Webviewに表示しているらしいことがわかりました。"),n("a",{attrs:{href:"https://code.visualstudio.com/api/extension-guides/webview",target:"_blank",rel:"noopener noreferrer"}},[t._v("公式ドキュメントのWebviewの項"),n("OutboundLink")],1),t._v("を見に行くと、可愛い猫ちゃんがキーボードをばしばししていたので集中力とやる気を失いました。靴下猫ちゃんかわいい。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" vscode "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vscode'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("activate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ExtensionContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subscriptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commands"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerCommand")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'catCoding.start'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create and show panel")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" panel "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWebviewPanel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'catCoding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cat Coding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ViewColumn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("One"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// And set its HTML content")]),t._v("\n      panel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWebviewContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWebviewContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Cat Coding</title>\n</head>\n<body>\n    <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" />\n</body>\n</html>')]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("二十分ほどで気を取り直してWebviewを表示するためのコードをコピペし、表示を確認。OK。HTMLの出し方もわかったので、ここに「今開いているテキスト」の内容を投入します。")]),t._v(" "),n("h2",{attrs:{id:"どのようにして「現在開いているテキストの内容」を取り出せるか？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#どのようにして「現在開いているテキストの内容」を取り出せるか？"}},[t._v("#")]),t._v(" どのようにして「現在開いているテキストの内容」を取り出せるか？")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/yzhang-gh/vscode-markdown",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode-markdown"),n("OutboundLink")],1),t._v("の"),n("a",{attrs:{href:"https://github.com/yzhang-gh/vscode-markdown/blob/master/src/preview.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode-markdown/src/preview.ts"),n("OutboundLink")],1),t._v("を見ると")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("activate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExtensionContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//(略)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Try preview when this extension is activated the first time")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("autoPreviewToSide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeTextEditor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//(略)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("autoPreviewToSide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("editor"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TextEditor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//(略)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" doc "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" editor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//(略)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("のような記述があります。これが良いような気がします。引数の型がわかったので"),n("a",{attrs:{href:"https://code.visualstudio.com/api/references/vscode-api#TextEditor",target:"_blank",rel:"noopener noreferrer"}},[t._v("公式ドキュメントのTextEditorの項"),n("OutboundLink")],1),t._v("を見に行きます。"),n("br"),t._v("\nどうやらwindow.activeTextEditor.document.getText()で「現在開いているテキストの内容」が取れそうです。")]),t._v(" "),n("p",[t._v("つまりこう。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" vscode "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vscode'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("activate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ExtensionContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subscriptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commands"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerCommand")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'catCoding.start'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create and show panel")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" panel "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWebviewPanel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'catCoding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cat Coding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ViewColumn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Two"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2カラムにしたかったので変更")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" editor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeTextEditor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("editor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// editor.addEventListener()")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" doc "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" editor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      panel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWebviewContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWebviewContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TextDocument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Cat Coding</title>\n</head>\n<body>\n    ')]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n</body>\n</html>")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("OK。"),n("br"),t._v("\nこれではテキストの取得が一回のみなので、テキストを変更したときにWebview側の表示も変わるようにしましょう。")]),t._v(" "),n("h2",{attrs:{id:"いわゆるwatchてきな。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#いわゆるwatchてきな。"}},[t._v("#")]),t._v(" いわゆるwatchてきな。")]),t._v(" "),n("p",[t._v("おそらく"),n("code",[t._v("addEventListener")]),t._v("みたいな、あるいは"),n("code",[t._v("watch()")]),t._v("のような何かがあるのだろうと検討をつけて探します。探すというかまあ、すぐ下に"),n("a",{attrs:{href:"https://code.visualstudio.com/api/references/vscode-api#TextDocumentContentChangeEvent",target:"_blank",rel:"noopener noreferrer"}},[t._v("TextDocumentContentChangeEvent"),n("OutboundLink")],1),t._v("という項目があるので探すまでもなくこれです。"),n("br"),t._v(" "),n("code",[t._v("TextDocumentChangeEvent")]),t._v("でページ内検索をすると、どうもこれは"),n("code",[t._v("workspace")]),t._v("から発生してくるらしいことが見えます。")]),t._v(" "),n("p",[t._v("つまりこう。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[t._v("    vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("workspace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onDidChangeTextDocument")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      panel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWebviewContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("書きながら「これもしかして作業ファイル切り替えてもおなじWebviewにプレビューされるのでは？と思い試したところ、その通りでした。まあいいか別に。")]),t._v(" "),n("h2",{attrs:{id:"ついでなので作業ファイルを切り替えたときにもプレビューを更新したい"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ついでなので作業ファイルを切り替えたときにもプレビューを更新したい"}},[t._v("#")]),t._v(" ついでなので作業ファイルを切り替えたときにもプレビューを更新したい")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/yzhang-gh/vscode-markdown",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode-markdown"),n("OutboundLink")],1),t._v("を見た感じたぶんここでしょう。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[t._v("    window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onDidChangeActiveTextEditor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("editor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("autoPreviewToSide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("editor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("これを")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[t._v("  vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onDidChangeActiveTextEditor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("editor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("editor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" doc "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" editor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    panel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWebviewContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("こんな感じ。"),n("br"),t._v("\n現在の"),n("code",[t._v("panel")]),t._v("だとクロージャから読めないので宣言を外に出します。なんかちょっとアンチケースのような気がします。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" vscode "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vscode'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" panel"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WebviewPanel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("activate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" vscode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ExtensionContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("以下略"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("これで無事、作業ファイルを切り替えたときにもプレビューを更新することができました。")]),t._v(" "),n("h2",{attrs:{id:"ちなみに"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ちなみに"}},[t._v("#")]),t._v(" ちなみに")]),t._v(" "),n("p",[t._v("あんまり面白くないので触れていませんが、ルビと傍点の処理は")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("convertToHtml")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" txt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\n/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<br />"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/[\\|｜](.+?)《(.+?)》/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<ruby>$1<rt>$2</rt></ruby>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/[\\|｜](.+?)（(.+?)）/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<ruby>$1<rt>$2</rt></ruby>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/[\\|｜](.+?)\\((.+?)\\)/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<ruby>$1<rt>$2</rt></ruby>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 漢字の連続の後に括弧が存在した場合、一連の漢字をベーステキスト、括弧内の文字をルビテキストとします。 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/([一-龠]+)《(.+?)》/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<ruby>$1<rt>$2</rt></ruby>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ただし丸括弧内の文字はひらがなかカタカナのみを指定できます。 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/([一-龠]+)（([ぁ-んァ-ヶ]+?)）/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<ruby>$1<rt>$2</rt></ruby>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/([一-龠]+)\\(([ぁ-んァ-ヶ]+?)\\)/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<ruby>$1<rt>$2</rt></ruby>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 括弧を括弧のまま表示したい場合は、括弧の直前に縦棒を入力します。 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/[\\|｜]《(.+?)》/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'《$1》'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/[\\|｜]（(.+?)）/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'（$1）'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/[\\|｜]\\((.+?)\\)/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'($1)'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 二重山括弧内を傍点付き文字列に変換する */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/《《(.+?)》》/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("match"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" boten "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"﹅"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("repeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<ruby>"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("p1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<rt>"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" boten "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"</rt></ruby>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("でやっています。"),n("br"),t._v("\nカクヨムだと傍点の画像があるっぽいんですけど、ここはめんどくさいので「ぼうてん」で変換して出てくるこいつ "),n("code",[t._v("﹅")]),t._v(" を文字数分ルビとして振っています。"),n("br"),t._v("\nこのコード（傍点以前）たしかインターネットのどこかからコピペしたもののはずですが、元がどこだったか見つからない……。同じサイトからコピペしてるらしい記事はいくつか出るんですが、少なくとも昨年5月よりは前のはずなので（昨年5月に別のコードに書き付けている）どれも違う。どこだったかメモっておくべきだった……。")]),t._v(" "),n("h2",{attrs:{id:"感想"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#感想"}},[t._v("#")]),t._v(" 感想")]),t._v(" "),n("p",[t._v("TypeScriptで書かれているので変数の型がわかりやすく、APIドキュメントをたどりやすくて助かりました。これいいな。"),n("br"),t._v("\nここからgithubで文章保存して何ならPDFも直接吐きたい。マークダウンをPDFにする拡張はあるっぽいのでやろうと思えばいけるのでは。")]),t._v(" "),n("h2",{attrs:{id:"で、"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#で、"}},[t._v("#")]),t._v(" で、")]),t._v(" "),n("p",[t._v("作ったはいいんですけど、これもしかして公開しないと使えないんですかね。毎回デバッグから開くのは嫌なんですけど。")])])}),[],!1,null,null,null);s.default=e.exports}}]);